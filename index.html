<script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ここからが主要な要素の取得 ---
            const taskCheckboxes = document.querySelectorAll('#taskTable input[type="checkbox"]');
            const progressText = document.getElementById('progress-text');
            const progressBar = document.getElementById('progress-bar');
            const totalTasks = taskCheckboxes.length;

            // --- 関数定義 ---

            /**
             * 進捗バーとテキストを更新する関数
             */
            function updateProgress() {
                const checkedTasks = document.querySelectorAll('#taskTable input[type="checkbox"]:checked').length;
                const progressPercentage = totalTasks > 0 ? Math.round((checkedTasks / totalTasks) * 100) : 0;
                
                progressText.textContent = `${progressPercentage}%`;
                progressBar.style.width = `${progressPercentage}%`;
                progressBar.textContent = `${progressPercentage}%`;
            }

            /**
             * チェックボックスの状態をローカルストレージに保存する関数
             * @param {HTMLInputElement} checkbox - 状態を保存するチェックボックス要素
             */
            function saveState(checkbox) {
                // チェックボックスのIDをキーとして、チェック状態(true/false)を保存
                localStorage.setItem(checkbox.id, checkbox.checked);
            }

            /**
             * ページ読み込み時に、保存された状態を復元する関数
             */
            function loadState() {
                taskCheckboxes.forEach(checkbox => {
                    // 保存された値を取得 (なければ null が返る)
                    const savedState = localStorage.getItem(checkbox.id);
                    
                    // 保存された値が 'true' 文字列であれば、チェックを入れる
                    if (savedState === 'true') {
                        checkbox.checked = true;
                    }
                });
            }

            // --- ここからがメインの処理 ---

            // 1. ページが読み込まれたら、まず保存された状態を復元する
            loadState();
            
            // 2. 復元した状態で、最初の進捗を計算して表示する
            updateProgress();

            // 3. 各チェックボックスにイベントリスナーを設定する
            taskCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    // チェック状態が変わったら…
                    saveState(checkbox);    // 状態を保存し、
                    updateProgress();       // 進捗を更新する
                });
            });
        });
    </script>
